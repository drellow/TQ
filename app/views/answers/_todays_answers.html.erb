
<!-- TODO: Break this into partials. -->

<% unless sorted_answers.empty? %>
  <% sorted_answers.each do |answer| %>
    <div class="user-answer">
      <div class="answer-header" style="background: <%=answer.user.color%>">
        <span><%= answer.user.username %>
          <span class="user-score" id="user<%= answer.user.id %>-score">
            <%=answer.score%>
          </span>
          <% if answer.user != current_user %>
          <span class="answer-buttons">
          <%= button_to "+", answer_vote_path(answer_id: answer.id,
              score: "up"), remote: true, method: :post,
              form_class: "vote-form", class: "btn" %>

          <%= button_to "-", answer_vote_path(answer_id: answer.id,
              score: "down"), remote: true, method: :post,
              form_class: "vote-form", class: "btn" %>
          </span>
          <% end %>
          <br>
          <span class="title">
            <%= answer.user.title %>
          </span>
          <% if current_user.provider == "facebook" && current_user.friends_with?(answer.user) %>
            <span class="fb-friend">
                  Your friend.
            </span>
          <% end %>
        </span>
      </div>

      <div class="answer-body">
        <p>
          <%= sanitize(simple_format(answer.body),
            :tags => %w(br p) )%>
        </p>
      </div>

      <div class="comment-toggle">
        <span class="show-comments fake-link">Click to show
          <%=answer.comments.count %> comments
        </span>
      </div>

      <div class="comments">
        <div class="comment-collection">
        <%= render :partial => 'questions/comment',
                   :collection => answer.comments %>
        </div>

        <%= form_for([answer, answer.comments.build],
            :remote => true, :class => "new_comment" ) do |f| %>

          <%= f.text_area :body, :class => "comment_field" %>
          <%= f.submit "Add Comment", :class => "flat-button" %>
        <% end %>
        <span class="fake-link hide-comments">Click to hide
          <%=answer.comments.count %> comments
        </span>
      </div>

    </div>
  <% end %>
<% end %>